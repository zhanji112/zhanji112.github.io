<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>本地 OCR Demo</title>

  <!-- ✅ Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 1em; }
    h2 { color: #333; }
    img { max-width: 100%; margin-top: 10px; border: 1px solid #ccc; }
    .box { background: #f7f7f7; padding: 10px; margin-top: 1em; border-radius: 8px; }
    input[type="file"], input[type="text"] { display: block; margin-top: 0.5em; }
  </style>
</head>
<body>
  <h2>🧪 本地 OCR Demo</h2>

  <div class="box">
    <h3>🪪 上傳身分證照片</h3>
    <input type="file" accept="image/*" id="id-card-input">
    <img id="id-card-preview">
    <p><strong>OCR：</strong><span id="ocr-text">尚未辨識</span></p>
    <p><strong>姓名擷取：</strong><span id="ocr-name">尚未擷取</span></p>
  </div>

  <div class="box">
    <h3>🔍 使用者輸入姓名比對</h3>
    <input type="text" id="user-name" placeholder="請輸入您的姓名">
    <p><strong>比對結果：</strong><span id="name-match">尚未比對</span></p>
  </div>

  <script>
    let extractedName = '';

    // 身分證 OCR
    document.getElementById("id-card-input").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      document.getElementById("id-card-preview").src = URL.createObjectURL(file);
      document.getElementById("ocr-text").textContent = "辨識中...";

      try {
        const result = await Tesseract.recognize(
          file,
          'chi_tra',
          { langPath: './models/tesseract' }
        );
        const ocrText = result.data.text;
        document.getElementById("ocr-text").textContent = ocrText;

        // 擷取中文字姓名（2~4 字）
        const match = ocrText.match(/[\u4e00-\u9fa5]{2,4}/g);
        extractedName = match ? match[0] : '';
        document.getElementById("ocr-name").textContent = extractedName || '無法擷取姓名';

        compareName();
      } catch (error) {
        console.error('OCR 錯誤:', error);
        document.getElementById("ocr-text").textContent = 'OCR 錯誤，請檢查檔案或路徑';
      }
    });

    // 使用者比對輸入
    document.getElementById("user-name").addEventListener("input", compareName);

    function compareName() {
      const userInput = document.getElementById("user-name").value.trim();
      const result = document.getElementById("name-match");

      if (!userInput || !extractedName) {
        result.textContent = "尚未完成 OCR 或未輸入姓名";
        result.style.color = "gray";
        return;
      }

      if (userInput === extractedName) {
        result.textContent = "✅ 姓名一致";
        result.style.color = "green";
      } else {
        result.textContent = `❌ 不一致（OCR 擷取：${extractedName}）`;
        result.style.color = "red";
      }
    }
  </script>
</body>
</html>
