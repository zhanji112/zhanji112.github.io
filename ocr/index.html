<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æœ¬åœ° OCR Demo</title>

  <!-- âœ… Tesseract.js for OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 1em; }
    h2 { color: #333; }
    img { max-width: 100%; margin-top: 10px; border: 1px solid #ccc; }
    .box { background: #f7f7f7; padding: 10px; margin-top: 1em; border-radius: 8px; }
    input[type="file"], input[type="text"] { display: block; margin-top: 0.5em; }
  </style>
</head>
<body>
  <h2>ğŸ§ª æœ¬åœ° OCR Demo</h2>

  <div class="box">
    <h3>ğŸªª ä¸Šå‚³èº«åˆ†è­‰ç…§ç‰‡</h3>
    <input type="file" accept="image/*" id="id-card-input">
    <img id="id-card-preview">
    <p><strong>OCRï¼š</strong><span id="ocr-text">å°šæœªè¾¨è­˜</span></p>
    <p><strong>å§“åæ“·å–ï¼š</strong><span id="ocr-name">å°šæœªæ“·å–</span></p>
  </div>

  <div class="box">
    <h3>ğŸ” ä½¿ç”¨è€…è¼¸å…¥å§“åæ¯”å°</h3>
    <input type="text" id="user-name" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
    <p><strong>æ¯”å°çµæœï¼š</strong><span id="name-match">å°šæœªæ¯”å°</span></p>
  </div>

  <script>
    let extractedName = '';

    // èº«åˆ†è­‰ OCR
    document.getElementById("id-card-input").addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      document.getElementById("id-card-preview").src = URL.createObjectURL(file);
      document.getElementById("ocr-text").textContent = "è¾¨è­˜ä¸­...";

      try {
        const result = await Tesseract.recognize(
          file,
          'chi_tra',
          { langPath: './models/tesseract' }
        );
        const ocrText = result.data.text;
        document.getElementById("ocr-text").textContent = ocrText;

        // æ“·å–ä¸­æ–‡å­—å§“åï¼ˆ2~4 å­—ï¼‰
        const match = ocrText.match(/[\u4e00-\u9fa5]{2,4}/g);
        extractedName = match ? match[0] : '';
        document.getElementById("ocr-name").textContent = extractedName || 'ç„¡æ³•æ“·å–å§“å';

        compareName();
      } catch (error) {
        console.error('OCR éŒ¯èª¤:', error);
        document.getElementById("ocr-text").textContent = 'OCR éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆæˆ–è·¯å¾‘';
      }
    });

    // ä½¿ç”¨è€…æ¯”å°è¼¸å…¥
    document.getElementById("user-name").addEventListener("input", compareName);

    function compareName() {
      const userInput = document.getElementById("user-name").value.trim();
      const result = document.getElementById("name-match");

      if (!userInput || !extractedName) {
        result.textContent = "å°šæœªå®Œæˆ OCR æˆ–æœªè¼¸å…¥å§“å";
        result.style.color = "gray";
        return;
      }

      if (userInput === extractedName) {
        result.textContent = "âœ… å§“åä¸€è‡´";
        result.style.color = "green";
      } else {
        result.textContent = `âŒ ä¸ä¸€è‡´ï¼ˆOCR æ“·å–ï¼š${extractedName}ï¼‰`;
        result.style.color = "red";
      }
    }
  </script>
</body>
</html>
