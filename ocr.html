<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>èº«åˆ†è­‰ OCR å§“åé©—è­‰</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 2em;
    }
    h2 {
      color: #333;
    }
    img {
      max-width: 100%;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    .section {
      margin-top: 2em;
    }
    .result {
      background: #f5f5f5;
      padding: 1em;
      border-radius: 6px;
      margin-top: 1em;
    }
    input[type="text"] {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.5em;
    }
    button {
      margin-top: 1em;
    }
  </style>
</head>
<body>
  <h2>ğŸ§¾ èº«åˆ†è­‰ OCR å§“åé©—è­‰</h2>

  <div class="section">
    <label>ğŸ“„ ä¸Šå‚³èº«åˆ†è­‰ç…§ç‰‡ï¼š</label>
    <input type="file" id="id-upload" accept="image/*">
    <img id="id-preview" src="" alt="é è¦½åœ–">
  </div>

  <div class="section result">
    <strong>ğŸ“ƒ OCR å…¨æ–‡ï¼š</strong>
    <pre id="ocr-result">å°šæœªè¾¨è­˜</pre>
    <strong>ğŸ‘¤ æ“·å–çš„å§“åï¼š</strong>
    <p id="extracted-name">å°šæœªæ“·å–</p>
  </div>

  <div class="section">
    <label>ğŸ§‘ è«‹è¼¸å…¥æ‚¨çš„å§“åï¼š</label>
    <input type="text" id="user-name" placeholder="ä¾‹å¦‚ï¼šé™³ç­±ç²">
    <button onclick="compareName()">ğŸ” æ¯”å°å§“å</button>
    <div class="result">
      <strong>ğŸ“Œ æ¯”å°çµæœï¼š</strong>
      <p id="match-result">å°šæœªæ¯”å°</p>
    </div>
  </div>

  <script>
    const apiKey = 'AIzaSyAVhh3Xk7vNJMlvC6Exa-bW-v4zlCIe2kk'; // â† æ›¿æ›æˆä½ çš„ Google API é‡‘é‘°
    let extractedName = '';

    // æ“·å–ã€Œå§“åã€è¡Œå¾Œçš„å§“åå…§å®¹ï¼ˆé©ç”¨ï¼šå§“åé™³ç­±ç²ï¼‰
    function extractNameFromText(text) {
      const lines = text.split('\n');

      for (let line of lines) {
        line = line.trim();
        if (line.startsWith('å§“å')) {
          return line.replace('å§“å', '').replace(/\s/g, '');
        }
      }

      return '';
    }

    // ä¸Šå‚³åœ–ç‰‡ä¸¦ä½¿ç”¨ Google Vision OCR
    document.getElementById('id-upload').addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async () => {
        const base64 = reader.result.split(',')[1];
        document.getElementById('id-preview').src = reader.result;

        const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            requests: [{
              image: { content: base64 },
              features: [{ type: "TEXT_DETECTION" }]
            }]
          })
        });

        const data = await response.json();
        const text = data.responses?.[0]?.fullTextAnnotation?.text || "ç„¡æ³•è¾¨è­˜";
        document.getElementById('ocr-result').textContent = text;

        extractedName = extractNameFromText(text);
        document.getElementById('extracted-name').textContent = extractedName || 'æœªæ“·å–åˆ°å§“å';
      };

      reader.readAsDataURL(file);
    });

    // ä½¿ç”¨è€…è¼¸å…¥å§“åæ¯”å°
    function compareName() {
      const inputName = document.getElementById('user-name').value.trim();
      const resultText = document.getElementById('match-result');

      if (!inputName) {
        resultText.textContent = 'âš ï¸ è«‹è¼¸å…¥æ‚¨çš„å§“å';
        return;
      }

      if (!extractedName) {
        resultText.textContent = 'âš ï¸ å°šæœªæ“·å–åˆ°å§“åï¼Œè«‹ç¢ºèªèº«åˆ†è­‰ç…§ç‰‡';
        return;
      }

      if (inputName === extractedName) {
        resultText.textContent = 'âœ… å§“åä¸€è‡´';
      } else {
        resultText.textContent = `âŒ ä¸ä¸€è‡´ï¼ŒOCR æ“·å–ç‚ºï¼š${extractedName}`;
      }
    }
  </script>
</body>
</html>
